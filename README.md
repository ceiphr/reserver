<div id="top"></div>

# Reserver

<!-- TODO: Logo -->

[![CI][ci-shield]][ci-url]
![BASH Version][bash-version]
[![MIT License][license-shield]][license-url]

## About The Project

A _very mild_ contingency plan for servers that run out of space.
Based on this great article by Brian Schrader:
[Why All My Servers Have An 8gb Empty File](https://brianschrader.com/archive/why-all-my-servers-have-an-8gb-empty-file/).

<!-- TODO: Justify the script. -->

### Built and Tested With

-   [GNU Bash](https://www.gnu.org/software/bash/)
-   [Bash Automated Testing System](https://github.com/bats-core/bats-core)

## Installation

Run the following in the terminal of your server:

```sh
curl https://get.reserver.sh | sh
```

`get.reserver.sh` will run the installation script found here: [ceiphr/get.reserver.sh](https://github.com/ceiphr/get.reserver.sh). It uses `curl` or `wget` to get `reserver.sh` from this repository and makes it executable with `chmod +x reserver.sh`.

## Usage

Simply running the command will produce a **5GB** reservation file located at `$HOME/.reservation`:

```sh
./reserver.sh
```

Rerunning the script will ask if you'd like to delete the reservation.

You can provide a custom directory, file name or size:

```sh
./reserver -d /tmp -f foo -s 10
```

The above command will create a reservation file `foo` in `/tmp` that is **10GB** in size.

**Note**: The largest reservation size allowed is **50%** of the unallocated space on the disk.

When supplying custom arguments, `reserver.sh` will create `$HOME/.reserver.conf` that contains the configured directory and file name. **Do not edit this file**. It is for the script to keep track of your reservation.

When running the command again without arguments:

```sh
./reserver.sh
```

`reserver.sh` will read `.reserver.conf` to find where your reservation is. The script will ask if you'd like to delete the reservation, just like with the default configuration.

`reserver.sh` ensures that only one reservation exists on a system anytime the script is executed. To prevent multiple instances of the script from causing a race condition, `/tmp/reserver.lock` is created when the script is running. Other instances of the script will be blocked from running.

## License

Distributed under the MIT License. See [LICENSE](https://github.com/ceiphr/reserver/blob/main/LICENSE) for more information.

## Acknowledgments

This project both leveraged and took inspiration from the following products and projects:

-   [acme.sh](https://github.com/acmesh-official/acme.sh)
-   [get.acme.sh](https://github.com/acmesh-official/get.acme.sh)
-   [bocker](https://github.com/p8952/bocker)
-   [Minecraft Backup](https://github.com/nicolaschan/minecraft-backup)
-   [Img Shields](https://shields.io)(https://github.com/nicolaschan/minecraft-backup)
-   [Best-README-Template](https://github.com/othneildrew/Best-README-Template/blob/master/README.md)
-   [Vercel](https://vercel.com)
-   [Svelte Kit](https://kit.svelte.dev/)

<p align="right">(<a href="#top">back to top</a>)</p>

[bash-version]: https://img.shields.io/badge/Bash-v4.4%5E-green?&logo=gnubash&logoColor=white
[ci-shield]: https://img.shields.io/github/workflow/status/ceiphr/reserver/CI?color=green&logo=github
[ci-url]: https://github.com/ceiphr/reserver/actions/workflows/main.yml
[license-shield]: https://img.shields.io/github/license/ceiphr/reserver
[license-url]: https://github.com/othneildrew/Best-README-Template/blob/master/LICENSE.txt
