<h1><img src="assets/reserver.png" alt="Reserver"/></h1>
<div id="top"></div>

[![CI][ci-shield]][ci-url]
![Script Version][script-version]
![BASH Version][bash-version]
[![MIT License][license-shield]][license-url]

## About The Project

A _very mild_ contingency plan for servers that run out of space. Based on this great article by Brian Schrader: [Why All My Servers Have An 8gb Empty File](https://brianschrader.com/archive/why-all-my-servers-have-an-8gb-empty-file/).

Just like Schrader does in the article, this script will reserve space on a server, so, you can delete it later.

Specifically, when your server runs out of space, you can remove the reservation file this script produces so that the server will hopefully have enough space to function again while you try to fix whatever caused the issue.

You should always use monitoring software and or SaaS offerings such as [Datadog](https://www.datadoghq.com/) to monitor disk usage on your servers. That is the tool that will _really_ help you mitigate this potential problem. Think of `reserver.sh` as a sidekick. It's simple to use and is there if your primary tools somehow fail. It is a _mild_ contingency plan if you can spare the disk space.

### Built and Tested With

-   [GNU Bash](https://www.gnu.org/software/bash/)
-   [Bash Automated Testing System](https://github.com/bats-core/bats-core)

## Installation

Run the following in the terminal of your server:

```sh
curl https://get.reserver.sh | sh
```

`get.reserver.sh` will run the installation script found here: [ceiphr/get.reserver.sh](https://github.com/ceiphr/get.reserver.sh). It uses `curl` or `wget` to get `reserver.sh` from this repository and makes it executable with `chmod +x reserver.sh`.

## Usage

Simply running the command will produce a **5GB** reservation file located at `$HOME/.reservation`:

```txt
$ ./reserver.sh
Reserving 5GB of space...
Reservation complete!
```

Rerunning the script will ask if you'd like to delete the reservation:

```txt
$ ./reserver.sh
Reservation file already exists. Delete? [y/N]: y
Reservation removed. Good luck!
```

### Arguments

You can provide a custom directory, file name or size:

```txt
$ ./reserver.sh -d /tmp -f foo -s 10
Reservation size set to 10GB.
Reserving 10GB of space...
Reservation complete!
```

The above command will create a reservation file `foo` in `/tmp` that is **10GB** in size.

**Note**: The largest reservation size allowed is **50%** of the unallocated space on the disk.

When supplying custom arguments, `reserver.sh` will create `$HOME/.reserver.conf` that contains the configured directory and file name. **Do not edit this file**. It is for the script to keep track of your reservation.

When running the command again without arguments:

```txt
$ ./reserver.sh
Reservation file already exists. Delete? [y/N]: y
Reservation removed. Good luck!
```

`reserver.sh` will read `.reserver.conf` to find where your reservation is. The script will ask if you'd like to delete the reservation, just like with the default configuration.

`reserver.sh` ensures that only one reservation exists on a system anytime the script is executed. To prevent multiple instances of the script from causing a race condition, `/tmp/reserver.lock` is created when the script is running. Other instances of the script will be blocked from running.

## License

Distributed under the MIT License. See [LICENSE](https://github.com/ceiphr/reserver/blob/main/LICENSE) for more information.

## Acknowledgments

This project both leveraged and took inspiration from the following products and projects:

-   [acme.sh](https://github.com/acmesh-official/acme.sh)
-   [get.acme.sh](https://github.com/acmesh-official/get.acme.sh)
-   [Bocker](https://github.com/p8952/bocker)
-   [Minecraft Backup](https://github.com/nicolaschan/minecraft-backup)
-   [Img Shields](https://shields.io)
-   [Best-README-Template](https://github.com/othneildrew/Best-README-Template/blob/master/README.md)
-   [Vercel](https://vercel.com)
-   [Next.js](https://nextjs.org/)

<p align="right">(<a href="#top">back to top</a>)</p>

[script-version]: https://img.shields.io/github/v/release/ceiphr/reserver?color=green
[bash-version]: https://img.shields.io/badge/bash-v4.4%5E-green?&logo=gnubash&logoColor=white
[ci-shield]: https://img.shields.io/github/workflow/status/ceiphr/reserver/CI?color=green&logo=github
[ci-url]: https://github.com/ceiphr/reserver/actions/workflows/main.yml
[license-shield]: https://img.shields.io/github/license/ceiphr/reserver
[license-url]: https://github.com/ceiphr/reserver/blob/main/LICENSE
